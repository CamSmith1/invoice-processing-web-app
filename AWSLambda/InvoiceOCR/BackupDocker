FROM amazonlinux:2018.03.0.20200318.1

ENV LEPTONICA_VERSION="1.75.1"

WORKDIR /tmp/
RUN yum install python-devel openldap-devel clang ninja-build wget zip gzip tar autoconf xz libpng-devel libtiff-devel zlib-devel libwebp-devel libjpeg-turbo-devel make libtool pkgconfig git python36 python36-devel python36-pip python36-setuptools python36-virtualenv  -y
RUN alternatives --set python /usr/bin/python3.6
RUN pip install --upgrade pip
RUN wget https://github.com/DanBloomberg/leptonica/releases/download/$LEPTONICA_VERSION/leptonica-$LEPTONICA_VERSION.tar.gz
RUN tar -xzvf leptonica-$LEPTONICA_VERSION.tar.gz
RUN cd leptonica-$LEPTONICA_VERSION && ./configure && make && make install


RUN wget http://ftpmirror.gnu.org/autoconf-archive/autoconf-archive-2019.01.06.tar.xz
RUN tar -xvf autoconf-archive-2019.01.06.tar.xz
RUN cd autoconf-archive-2019.01.06 && ./configure && make && make install
RUN cd autoconf-archive-2019.01.06 && cp m4/* /usr/share/aclocal/

RUN git clone https://anongit.freedesktop.org/git/poppler/poppler.git
RUN pip3 install pdf2image
RUN pip3 install opencv-python  
RUN pip3 install chalice
RUN pip3 install pyOpenSSL
RUN pip3 install secrets
RUN pip3 install image



COPY build_tesseract.sh /tmp/build_tesseract.sh
RUN chmod +x /tmp/build_tesseract.sh
CMD sh /tmp/build_tesseract.sh




